# Converting events

Because *Stock* doesn't keep track of product names, *Dashboard* has to make two requests to show a list of current stock levels. You can improve the situation by taking the following steps.

First, make sure *Dashboard* tunes into the "product created" event too, so it can keep its own local list of products.

Next, *Dashboard* needs to keep track of the current stock level too. However, it isn't (and shouldn't be) interested in how this stock level gets determined (i.e. it doesn't need to know about receiving and delivering goods). Instead, every time something changes about the current stock level, *Stock* should simply produce an event, like "stock level increased", or "stock level decreased", allowing *Dashboard* to know what the new stock level has become (and not why this happened in the first place).

The current setup of the *Stock* consumer doesn't fit because, when restarted, it will start processing all events again. So it will create new "stock level changed" events every time the consumer restarts, which is not what we want. Producing a new event is called a *side-effect*, and we only want it to happen once. That's why, for this assignment, we should let the consumer process every message from the stream *just once*.
 
See for an example of such a consumer [`src/Common/consume_once.php`](../src/Common/consume_once.php). Read the code to find out what the differences are between this consumer and the one in [`consumer.php`](../src/Common/consumer.php).

Now,

1. Set up a dedicated *Stock* "consume once" consumer, which produces its own "stock level increased", "stock level decreased" events on the stream.
2. Let *Dashboard* consume these events and store the latest stock level in its own database.
3. Modify the existing *Stock* consumer to also respond to those "stock level increased" and "stock level decreased" events, instead of to the more specific "purchase order received" and "sales order delivered" events.

The *Dashboard* consumer can be a regular one, because it has no side-effects, so you can process all events again upon restart.
